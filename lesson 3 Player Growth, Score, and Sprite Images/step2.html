<!DOCTYPE html>
<html>
    <head>
        <title>Fishy Game</title>
        <script src="https://unpkg.com/kontra@10.0.2/kontra.js"></script>
        <style>
            canvas {
                display: block;
                margin: auto;
                background-color: #88ccee;
                border: 3px solid black;
            }
        </style>
    </head>
    <body>
        <canvas id="game" width="800" height="600"></canvas>
        <script>
            let {init, Sprite, GameLoop, initKeys, keyPressed, load, Text} = kontra;  <!-- added Text here -->
            let {canvas, context} = init('game');
            initKeys();
            let score = 0;          // ðŸŸ© Added Score Tracking
            let scoreText = Text({
                text: 'Score: 0',
                font: '20px Arial',
                color: 'black',
                x: 10,
                y: 10
            });
            load('background.png', 'player.png').then(images => {
                let [backgroundImage, playerImage] = images;
                let background = Sprite({
                    x: 0,
                    y: 0,
                    image: backgroundImage,
                    width: canvas.width,
                    height: canvas.height,
                    render() {
                        this.context.drawImage
                        (this.image, this.x, this.y, canvas.width, canvas.height);
                    }
                });
                let player = Sprite({
                    x: 100,
                    y: 100,
                    width: 60,
                    height: 45,
                    image: playerImage,
                    size: 40, // ðŸŸ© Added size property for growth tracking
                    update() {
                        if (keyPressed('arrowleft')) this.x -= 4;
                        if (keyPressed('arrowright')) this.x += 4;
                        if (keyPressed('arrowup')) this.y -= 4;
                        if (keyPressed('arrowdown')) this.y += 4;
                    },
                });
                let enemies = [];
                function isoverlapping(min1, max1, min2, max2) {
                    return max1 >= min2 && max2 >= min1;
                }
                function iscolliding(sprite1, sprite2) {
                    return isoverlapping(sprite1.x, sprite1.x + sprite1.width, sprite2.x, sprite2.x+ sprite2.width) &&
                        isoverlapping(sprite1.y, sprite1.y + sprite1.height, sprite2.y, sprite2.y + sprite2.height);
                }
                let spawnTimer = 60;
                let loop = kontra.GameLoop({
                    update() {
                        player.update();
                        enemies.forEach(e => e.update());
                        enemies = enemies.filter(e => e.isAlive());

                        // ðŸŸ© Updated collision logic for Step 3
                        enemies.forEach(e => {
                            if (iscolliding(player, e) && !e.wasEaten) {
                                if (e.width * e.height < player.size * player.size) {
                                    e.wasEaten = true;
                                    e.color = "blue"; // Optional visual feedback
                                    player.size += 2; // Grow player
                                    player.width += 2;
                                    player.height += 2;
                                    score += 1;
                                    scoreText.text = 'Score: ' + score;
                                } else {
                                    console.log("That fish is too big!");
                                }
                            }
                        });

                        spawnTimer--;
                        if (spawnTimer <= 0) {
                            // ðŸŸ© Make enemies of random sizes (some small, some big)
                            let enemyWidth = Math.floor(Math.random() * 40) + 20; // 20â€“60
                            let enemyHeight = Math.floor(Math.random() * 20) + 15; // 15â€“35

                            let newEnemy = kontra.Sprite({
                                x: 800,
                                y: Math.random() * (canvas.height - 30),
                                width: enemyWidth,
                                height: enemyHeight,
                                dx: - (Math.random() * 3 + 1),
                                color: 'red',
                                update() {
                                    this.advance();
                                    if (this.x + this.width < 0) {
                                        this.ttl = 0;
                                    }
                                },
                                render() {
                                    this.context.fillStyle = this.color;
                                    this.context.fillRect(this.x, this.y, this.width, this.height);
                                }
                            });

                            enemies.push(newEnemy);
                            spawnTimer = 60;
                        }
                    },
                    render() {
                        background.render();
                        player.render();
                        enemies.forEach(e => e.render());
                        scoreText.render();   // ðŸŸ© render score text on top
                    }
                });
                loop.start();
            });
        </script>
    </body>
</html>
